<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Excercise Solutions â€“ lidRtutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./img/logo.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-c3e9721a79885947f4bfdcdb0d329912.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="assets/custom.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./img/logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">lidRtutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./01_read.html"> 
<span class="menu-text">1-LAS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./02_dtm.html"> 
<span class="menu-text">2-DTM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./03_chm.html"> 
<span class="menu-text">3-CHM</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./04_metrics.html"> 
<span class="menu-text">4-METRICS</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./05_engine.html"> 
<span class="menu-text">5-LASCATALOG</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./06_solutions.html" aria-current="page"> 
<span class="menu-text">6-SOLUTIONS</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-supplemental" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">SUPPLEMENTAL</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-supplemental">    
        <li>
    <a class="dropdown-item" href="./supplemental/S1_roi.html">
 <span class="dropdown-text">ROI</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./supplemental/S2_its.html">
 <span class="dropdown-text">ITS</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#resources" id="toc-resources" class="nav-link active" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#las" id="toc-las" class="nav-link" data-scroll-target="#las">1-LAS</a>
  <ul>
  <li><a href="#e1." id="toc-e1." class="nav-link" data-scroll-target="#e1.">E1.</a></li>
  <li><a href="#e2." id="toc-e2." class="nav-link" data-scroll-target="#e2.">E2.</a></li>
  <li><a href="#e3." id="toc-e3." class="nav-link" data-scroll-target="#e3.">E3.</a></li>
  <li><a href="#e4." id="toc-e4." class="nav-link" data-scroll-target="#e4.">E4.</a></li>
  </ul></li>
  <li><a href="#roi" id="toc-roi" class="nav-link" data-scroll-target="#roi">2-ROI</a>
  <ul>
  <li><a href="#e1.-1" id="toc-e1.-1" class="nav-link" data-scroll-target="#e1.-1">E1.</a></li>
  <li><a href="#e2.-1" id="toc-e2.-1" class="nav-link" data-scroll-target="#e2.-1">E2.</a></li>
  <li><a href="#e3.-1" id="toc-e3.-1" class="nav-link" data-scroll-target="#e3.-1">E3.</a></li>
  </ul></li>
  <li><a href="#aba" id="toc-aba" class="nav-link" data-scroll-target="#aba">3-ABA</a>
  <ul>
  <li><a href="#e1.-2" id="toc-e1.-2" class="nav-link" data-scroll-target="#e1.-2">E1.</a></li>
  <li><a href="#e2.-2" id="toc-e2.-2" class="nav-link" data-scroll-target="#e2.-2">E2.</a></li>
  <li><a href="#e3.-2" id="toc-e3.-2" class="nav-link" data-scroll-target="#e3.-2">E3.</a></li>
  </ul></li>
  <li><a href="#dtm" id="toc-dtm" class="nav-link" data-scroll-target="#dtm">5-DTM</a>
  <ul>
  <li><a href="#e1.-3" id="toc-e1.-3" class="nav-link" data-scroll-target="#e1.-3">E1.</a></li>
  <li><a href="#e2.-3" id="toc-e2.-3" class="nav-link" data-scroll-target="#e2.-3">E2.</a></li>
  <li><a href="#e3.-3" id="toc-e3.-3" class="nav-link" data-scroll-target="#e3.-3">E3.</a></li>
  <li><a href="#e4.-1" id="toc-e4.-1" class="nav-link" data-scroll-target="#e4.-1">E4.</a></li>
  <li><a href="#e5." id="toc-e5." class="nav-link" data-scroll-target="#e5.">E5.</a></li>
  <li><a href="#e6." id="toc-e6." class="nav-link" data-scroll-target="#e6.">E6.</a></li>
  <li><a href="#e7." id="toc-e7." class="nav-link" data-scroll-target="#e7.">E7.</a></li>
  </ul></li>
  <li><a href="#its" id="toc-its" class="nav-link" data-scroll-target="#its">6-ITS</a>
  <ul>
  <li><a href="#e1.-4" id="toc-e1.-4" class="nav-link" data-scroll-target="#e1.-4">E1.</a></li>
  <li><a href="#e2.-4" id="toc-e2.-4" class="nav-link" data-scroll-target="#e2.-4">E2.</a></li>
  <li><a href="#e3.-4" id="toc-e3.-4" class="nav-link" data-scroll-target="#e3.-4">E3.</a></li>
  <li><a href="#e4.-2" id="toc-e4.-2" class="nav-link" data-scroll-target="#e4.-2">E4.</a></li>
  <li><a href="#e5.-1" id="toc-e5.-1" class="nav-link" data-scroll-target="#e5.-1">E5.</a></li>
  </ul></li>
  <li><a href="#lascatalog" id="toc-lascatalog" class="nav-link" data-scroll-target="#lascatalog">7-LASCATALOG</a>
  <ul>
  <li><a href="#e1.-5" id="toc-e1.-5" class="nav-link" data-scroll-target="#e1.-5">E1.</a></li>
  <li><a href="#e2.-5" id="toc-e2.-5" class="nav-link" data-scroll-target="#e2.-5">E2.</a></li>
  <li><a href="#e3.-5" id="toc-e3.-5" class="nav-link" data-scroll-target="#e3.-5">E3.</a></li>
  <li><a href="#e4.-3" id="toc-e4.-3" class="nav-link" data-scroll-target="#e4.-3">E4.</a></li>
  <li><a href="#e5.-2" id="toc-e5.-2" class="nav-link" data-scroll-target="#e5.-2">E5.</a></li>
  </ul></li>
  <li><a href="#engine" id="toc-engine" class="nav-link" data-scroll-target="#engine">8-ENGINE</a>
  <ul>
  <li><a href="#e1.-6" id="toc-e1.-6" class="nav-link" data-scroll-target="#e1.-6">E1.</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Excercise Solutions</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><a href="https://github.com/liamirwin/LPS_lidRtutorial/blob/master/R/08_solutions.R">Code</a></li>
</ul>
</section>
<section id="las" class="level2">
<h2 class="anchored" data-anchor-id="las">1-LAS</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lidR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="e1." class="level4">
<h4 class="anchored" data-anchor-id="e1.">E1.</h4>
<p>What are withheld points? Where are they in our pointcloud?</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># According to ASPRS LAS specification http://www.asprs.org/wp-content/uploads/2019/07/LAS_1_4_r15.pdf page 18 "a point # that should not be included in processing (synonymous with Deleted)"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># They are on the edges. It looks like they correspond to a buffer. LAStools makes use of the withheld bit to flag some # points. Without more information on former processing step it is hard to say.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e2." class="level4">
<h4 class="anchored" data-anchor-id="e2.">E2.</h4>
<p>Read the file dropping the withheld points.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">filter =</span> <span class="st">"-drop_withheld"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e3." class="level4">
<h4 class="anchored" data-anchor-id="e3.">E3.</h4>
<p>The withheld points seem to be legitimate points that we want to keep.</p>
<p>Try to load the file including the withheld points but get rid of the warning (without using <code>suppressWarnings()</code>). Hint: Check available <code>-set_withheld</code> filters in <code>readLAS(filter = "-h")</code></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">filter =</span> <span class="st">"-set_withheld_flag 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">color =</span> <span class="st">"Withheld_flag"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e4." class="level4">
<h4 class="anchored" data-anchor-id="e4.">E4.</h4>
<p>Load only the ground points and plot the point-cloud coloured by the return number of the point. Do it loading the strict minimal amount of memory (4.7 Mb). Hint: use <code>?lidR::readLAS</code> and see what <code>select</code> options might help.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">filter =</span> <span class="st">"-keep_class 2 -set_withheld_flag 0"</span>, <span class="at">select =</span> <span class="st">"r"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">color =</span> <span class="st">"ReturnNumber"</span>, <span class="at">legend =</span> T)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">format</span>(<span class="fu">object.size</span>(las), <span class="st">"Mb"</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "4.6 Mb"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="roi" class="level2">
<h2 class="anchored" data-anchor-id="roi">2-ROI</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">select =</span> <span class="st">"xyz"</span>) <span class="co"># Re-load </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<pre><code>#&gt; Warning: There are 127471 points flagged 'withheld'.
plots &lt;- st_read("data/shapefiles/MixedEucaNatPlot.shp")
#&gt; Reading layer `MixedEucaNatPlot' from data source 
#&gt;   `C:\Users\lakirwin\Documents\GitHub\LPS_lidRtutorial\data\shapefiles\MixedEucaNatPlot.shp' 
#&gt;   using driver `ESRI Shapefile'
#&gt; Simple feature collection with 5 features and 1 field
#&gt; Geometry type: POINT
#&gt; Dimension:     XY
#&gt; Bounding box:  xmin: 203879.6 ymin: 7358932 xmax: 203960.6 ymax: 7359033
#&gt; Projected CRS: SIRGAS 2000 / UTM zone 23S
plot(las@header, map = FALSE)
plot(plots, add = TRUE)</code></pre>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/roi-plots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="e1.-1" class="level4">
<h4 class="anchored" data-anchor-id="e1.-1">E1.</h4>
<p>Clip the 5 plots with a radius of 11.3 m,</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>inventory <span class="ot">&lt;-</span> <span class="fu">clip_roi</span>(las, plots, <span class="at">radius =</span> <span class="fl">11.3</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(inventory[[<span class="dv">2</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e2.-1" class="level4">
<h4 class="anchored" data-anchor-id="e2.-1">E2.</h4>
<p>Clip a transect from A <code>c(203850, 7358950)</code> to B <code>c(203950, 7959000)</code>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tr <span class="ot">&lt;-</span> <span class="fu">clip_transect</span>(las, <span class="fu">c</span>(<span class="dv">203850</span>, <span class="dv">7358950</span>), <span class="fu">c</span>(<span class="dv">203950</span>, <span class="dv">7359000</span>), <span class="at">width =</span> <span class="dv">5</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tr, <span class="at">axis =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e3.-1" class="level4">
<h4 class="anchored" data-anchor-id="e3.-1">E3.</h4>
<p>Clip a transect from A <code>c(203850, 7358950)</code> to B <code>c(203950, 7959000)</code> but reorient it so it is no longer on the XY diagonal. Hint = <code>?clip_transect</code></p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>ptr <span class="ot">&lt;-</span> <span class="fu">clip_transect</span>(las, <span class="fu">c</span>(<span class="dv">203850</span>, <span class="dv">7358950</span>), <span class="fu">c</span>(<span class="dv">203950</span>, <span class="dv">7359000</span>), <span class="at">width =</span> <span class="dv">5</span>, <span class="at">xz =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tr, <span class="at">axis =</span> T)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ptr, <span class="at">axis =</span> T)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ptr<span class="sc">$</span>X, ptr<span class="sc">$</span>Z, <span class="at">cex =</span> <span class="fl">0.25</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">asp =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/roi-e3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="aba" class="level2">
<h2 class="anchored" data-anchor-id="aba">3-ABA</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">select =</span> <span class="st">"*"</span>,  <span class="at">filter =</span> <span class="st">"-set_withheld_flag 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="e1.-2" class="level4">
<h4 class="anchored" data-anchor-id="e1.-2">E1.</h4>
<p>Assuming that biomass is estimated using the equation <code>B = 0.5 * mean Z + 0.9 * 90th percentile of Z</code> applied on first returns only, map the biomass.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fl">0.5</span><span class="sc">*</span><span class="fu">mean</span>(Z) <span class="sc">+</span> <span class="fl">0.9</span><span class="sc">*</span><span class="fu">quantile</span>(Z, <span class="at">probs =</span> <span class="fl">0.9</span>), <span class="dv">10</span>, <span class="at">filter =</span> <span class="sc">~</span>ReturnNumber <span class="sc">==</span> <span class="dv">1</span>L)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(B, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/aba-e1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, .stdmetrics_z, <span class="dv">10</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fl">0.5</span><span class="sc">*</span>B[[<span class="st">"zmean"</span>]] <span class="sc">+</span> <span class="fl">0.9</span><span class="sc">*</span>B[[<span class="st">"zq90"</span>]]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(B, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/aba-e1-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">as.list</span>(<span class="fu">quantile</span>(Z), <span class="dv">10</span>))</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; class       : SpatRaster </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; size        : 8, 8, 5  (nrow, ncol, nlyr)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; resolution  : 20, 20  (x, y)</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; extent      : 203820, 203980, 7358900, 7359060  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; coord. ref. : SIRGAS 2000 / UTM zone 23S (EPSG:31983) </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; source(s)   : memory</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; names       : 0%,   25%,   50%,  75%,  100% </span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min values  :  0,  0.00,  0.00,  0.0,  0.79 </span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max values  :  0, 12.32, 17.19, 27.4, 34.46</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e2.-2" class="level4">
<h4 class="anchored" data-anchor-id="e2.-2">E2.</h4>
<p>Map the density of ground returns at a 5 m resolution with <code>pixel_metrics(filter = ~Classification == LASGROUND)</code>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>GND <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">length</span>(Z)<span class="sc">/</span><span class="dv">25</span>, <span class="at">res =</span> <span class="dv">5</span>, <span class="at">filter =</span> <span class="sc">~</span>Classification <span class="sc">==</span> LASGROUND)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(GND, <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/aba-e2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e3.-2" class="level4">
<h4 class="anchored" data-anchor-id="e3.-2">E3.</h4>
<p>Map pixels that are flat (planar) using <code>stdshapemetrics</code>. These could indicate potential roads.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, .stdshapemetrics, <span class="at">res =</span> <span class="dv">3</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m[[<span class="st">"planarity"</span>]], <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/aba-e3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>flat <span class="ot">&lt;-</span> m[[<span class="st">"planarity"</span>]] <span class="sc">&gt;</span> <span class="fl">0.85</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(flat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/aba-e3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="dtm" class="level2">
<h2 class="anchored" data-anchor-id="dtm">5-DTM</h2>
<section id="e1.-3" class="level4">
<h4 class="anchored" data-anchor-id="e1.-3">E1.</h4>
<p>Plot and compare these two normalized point-clouds. Why do they look different? Fix that. Hint: filter.</p>
<p>Some non ground points are below 0. It can be slightly low noise point not classified as ground by the data provider. This low points not being numerous and dark blue we hardly see them</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>las1 <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat.laz"</span>, <span class="at">filter =</span> <span class="st">"-set_withheld_flag 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>nlas1 <span class="ot">&lt;-</span> <span class="fu">normalize_height</span>(las1, <span class="fu">tin</span>())</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>nlas2 <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">filter =</span> <span class="st">"-set_withheld_flag 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nlas1)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nlas2)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>nlas1 <span class="ot">&lt;-</span> <span class="fu">filter_poi</span>(nlas1, Z <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">0.1</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nlas1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e2.-3" class="level4">
<h4 class="anchored" data-anchor-id="e2.-3">E2.</h4>
<p>Clip a plot somewhere in <code>MixedEucaNat.laz</code> (the non-normalized file).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>circ <span class="ot">&lt;-</span> <span class="fu">clip_circle</span>(las, <span class="dv">203930</span>, <span class="dv">7359000</span>, <span class="dv">25</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(circ)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e3.-3" class="level4">
<h4 class="anchored" data-anchor-id="e3.-3">E3.</h4>
<p>Compute a DTM for this plot. Which method are you choosing and why?</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>dtm <span class="ot">&lt;-</span> <span class="fu">rasterize_terrain</span>(circ, <span class="fl">0.5</span>, <span class="fu">kriging</span>())</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_dtm3d</span>(dtm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e4.-1" class="level4">
<h4 class="anchored" data-anchor-id="e4.-1">E4.</h4>
<p>Compute a DSM (digital surface model). Hint: Look back to how you made a CHM.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>dsm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(circ, <span class="dv">1</span>, <span class="fu">p2r</span>(<span class="fl">0.1</span>))</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dsm, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/dtm-e4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e5." class="level4">
<h4 class="anchored" data-anchor-id="e5.">E5.</h4>
<p>Normalize the plot.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ncirc <span class="ot">&lt;-</span> circ <span class="sc">-</span> dtm</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ncirc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e6." class="level4">
<h4 class="anchored" data-anchor-id="e6.">E6.</h4>
<p>Compute a CHM.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(ncirc, <span class="dv">1</span>, <span class="fu">p2r</span>(<span class="fl">0.1</span>))</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> <span class="fu">height.colors</span>(<span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/dtm-e6-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e7." class="level4">
<h4 class="anchored" data-anchor-id="e7.">E7.</h4>
<p>Estimate some metrics of interest in this plot with <code>cloud_metrics()</code>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">cloud_metrics</span>(ncirc, .stdmetrics_z)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>metrics</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zmax</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 31.41</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zmean</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 11.11374</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zsd</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 11.44308</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zskew</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0.4123246</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zkurt</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.42725</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zentropy</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] NA</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pzabovezmean</span></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 42.39526</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $pzabove2</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 60.61408</span></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq5</span></span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq10</span></span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq15</span></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq20</span></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq25</span></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq30</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 0</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq35</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 1.18</span></span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq40</span></span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 2.14</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq45</span></span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 3.62</span></span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq50</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 5.25</span></span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq55</span></span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 8.903</span></span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq60</span></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 13.12</span></span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq65</span></span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 18.32</span></span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq70</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 22.1</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq75</span></span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 24.31</span></span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq80</span></span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 25.62</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-75"><a href="#cb29-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq85</span></span>
<span id="cb29-76"><a href="#cb29-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 26.7</span></span>
<span id="cb29-77"><a href="#cb29-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-78"><a href="#cb29-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq90</span></span>
<span id="cb29-79"><a href="#cb29-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 27.53</span></span>
<span id="cb29-80"><a href="#cb29-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-81"><a href="#cb29-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zq95</span></span>
<span id="cb29-82"><a href="#cb29-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 28.39</span></span>
<span id="cb29-83"><a href="#cb29-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-84"><a href="#cb29-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum1</span></span>
<span id="cb29-85"><a href="#cb29-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 18.12365</span></span>
<span id="cb29-86"><a href="#cb29-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-87"><a href="#cb29-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum2</span></span>
<span id="cb29-88"><a href="#cb29-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 30.03214</span></span>
<span id="cb29-89"><a href="#cb29-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-90"><a href="#cb29-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum3</span></span>
<span id="cb29-91"><a href="#cb29-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 35.78736</span></span>
<span id="cb29-92"><a href="#cb29-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-93"><a href="#cb29-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum4</span></span>
<span id="cb29-94"><a href="#cb29-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 41.12687</span></span>
<span id="cb29-95"><a href="#cb29-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-96"><a href="#cb29-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum5</span></span>
<span id="cb29-97"><a href="#cb29-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 45.38727</span></span>
<span id="cb29-98"><a href="#cb29-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-99"><a href="#cb29-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum6</span></span>
<span id="cb29-100"><a href="#cb29-100" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 49.90123</span></span>
<span id="cb29-101"><a href="#cb29-101" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-102"><a href="#cb29-102" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum7</span></span>
<span id="cb29-103"><a href="#cb29-103" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 56.24318</span></span>
<span id="cb29-104"><a href="#cb29-104" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-105"><a href="#cb29-105" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum8</span></span>
<span id="cb29-106"><a href="#cb29-106" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 68.07501</span></span>
<span id="cb29-107"><a href="#cb29-107" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb29-108"><a href="#cb29-108" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; $zpcum9</span></span>
<span id="cb29-109"><a href="#cb29-109" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 91.75045</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="its" class="level2">
<h2 class="anchored" data-anchor-id="its">6-ITS</h2>
<p>Using:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(<span class="at">files =</span> <span class="st">"data/MixedEucaNat_normalized.laz"</span>, <span class="at">filter =</span> <span class="st">"-set_withheld_flag 0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>col1 <span class="ot">&lt;-</span> <span class="fu">height.colors</span>(<span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="e1.-4" class="level4">
<h4 class="anchored" data-anchor-id="e1.-4">E1.</h4>
<p>Find and count the trees.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ttops <span class="ot">&lt;-</span> <span class="fu">locate_trees</span>(<span class="at">las =</span> las, <span class="at">algorithm =</span> <span class="fu">lmf</span>(<span class="at">ws =</span> <span class="dv">3</span>, <span class="at">hmin =</span> <span class="dv">5</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">plot</span>(las)</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add_treetops3d</span>(<span class="at">x =</span> x, <span class="at">ttops =</span> ttops)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e2.-4" class="level4">
<h4 class="anchored" data-anchor-id="e2.-4">E2.</h4>
<p>Compute and map the density of trees with a 10 m resolution.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="at">x =</span> ttops)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(r) <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>r <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(<span class="at">x =</span> ttops, <span class="at">y =</span> r, <span class="st">"treeID"</span>, <span class="at">fun =</span> <span class="st">'count'</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(r, <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/its-e2-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e3.-4" class="level4">
<h4 class="anchored" data-anchor-id="e3.-4">E3.</h4>
<p>Segment the trees.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>chm <span class="ot">&lt;-</span> <span class="fu">rasterize_canopy</span>(<span class="at">las =</span> las, <span class="at">res =</span> <span class="fl">0.5</span>, <span class="at">algorithm =</span> <span class="fu">p2r</span>(<span class="at">subcircle =</span> <span class="fl">0.15</span>))</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(chm, <span class="at">col =</span> col1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/its-e3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ttops <span class="ot">&lt;-</span> <span class="fu">locate_trees</span>(<span class="at">las =</span> chm, <span class="at">algorithm =</span> <span class="fu">lmf</span>(<span class="at">ws =</span> <span class="fl">2.5</span>))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">segment_trees</span>(<span class="at">las =</span> las, <span class="fu">dalponte2016</span>(<span class="at">chm =</span> chm, <span class="at">treetops =</span> ttops))</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las, <span class="at">color =</span> <span class="st">"treeID"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e4.-2" class="level4">
<h4 class="anchored" data-anchor-id="e4.-2">E4.</h4>
<p>Assuming that a value of interest of a tree can be estimated using the crown area and the mean <code>Z</code> of the points with the formula <code>2.5 * area + 3 * mean Z</code>. Estimate the value of interest of each tree.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>value_of_interest <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y,z)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">stdtreemetrics</span>(x,y,z)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  avgz <span class="ot">&lt;-</span> <span class="fu">mean</span>(z)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fl">2.5</span><span class="sc">*</span>m<span class="sc">$</span>convhull_area <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> avgz</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">V =</span> v))</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">crown_metrics</span>(<span class="at">las =</span> las, <span class="at">func =</span> <span class="sc">~</span><span class="fu">value_of_interest</span>(X,Y,Z))</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> V[<span class="st">"V"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/its-e4-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e5.-1" class="level4">
<h4 class="anchored" data-anchor-id="e5.-1">E5.</h4>
<p>Map the total biomass at a resolution of 10 m. The output is a mixed of ABA and ITS</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Vtot <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(V, r, <span class="st">"V"</span>, <span class="at">fun =</span> <span class="st">"sum"</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(Vtot, <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/its-e5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="lascatalog" class="level2">
<h2 class="anchored" data-anchor-id="lascatalog">7-LASCATALOG</h2>
<p>This exercise is complex because it involves options not yet described. Be sure to use the <a href="https://r-lidar.github.io/lidRbook/index.html">lidRbook</a> and <a href="https://cran.r-project.org/web/packages/lidR/lidR.pdf">package documentation</a>.</p>
<p>Using:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ctg <span class="ot">&lt;-</span> <span class="fu">readLAScatalog</span>(<span class="at">folder =</span> <span class="st">"data/Farm_A/"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="e1.-5" class="level4">
<h4 class="anchored" data-anchor-id="e1.-5">E1.</h4>
<p>Generate a raster of point density for the provided catalog. Hint: Look through the documentation for a function that will do this!</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>ctg <span class="ot">&lt;-</span> <span class="fu">readLAScatalog</span>(<span class="st">"data/Farm_A/"</span>, <span class="at">filter =</span> <span class="st">"-drop_withheld -drop_z_below 0 -drop_z_above 40"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>D1 <span class="ot">&lt;-</span> <span class="fu">rasterize_density</span>(<span class="at">las =</span> ctg, <span class="at">res =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<pre><code>#&gt; Chunk 1 of 25 (4%): state âœ“
#&gt; 
                                                                                
Chunk 2 of 25 (8%): state âœ“
#&gt; 
                                                                                
Chunk 3 of 25 (12%): state âœ“
#&gt; 
                                                                                
Chunk 4 of 25 (16%): state âœ“
#&gt; 
                                                                                
Chunk 5 of 25 (20%): state âœ“
#&gt; 
                                                                                
Chunk 6 of 25 (24%): state âœ“
#&gt; 
                                                                                
Chunk 7 of 25 (28%): state âœ“
#&gt; 
[====&gt;                                             ] 8% ETA: 25s     
                                                                                
Chunk 8 of 25 (32%): state âœ“
#&gt; 
[====&gt;                                             ] 8% ETA: 26s     
                                                                                
Chunk 9 of 25 (36%): state âœ“
#&gt; 
[====&gt;                                             ] 8% ETA: 29s     
                                                                                
Chunk 10 of 25 (40%): state âœ“
#&gt; 
                                                                                
Chunk 11 of 25 (44%): state âœ“
#&gt; 
                                                                                
Chunk 12 of 25 (48%): state âœ“
#&gt; 
                                                                                
Chunk 13 of 25 (52%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 25s     
                                                                                
Chunk 14 of 25 (56%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 26s     
                                                                                
Chunk 15 of 25 (60%): state âœ“
#&gt; 
                                                                                
Chunk 16 of 25 (64%): state âœ“
#&gt; 
                                                                                
Chunk 17 of 25 (68%): state âœ“
#&gt; 
                                                                                
Chunk 18 of 25 (72%): state âœ“
#&gt; 
                                                                                
Chunk 19 of 25 (76%): state âœ“
#&gt; 
                                                                                
Chunk 20 of 25 (80%): state âœ“
#&gt; 
                                                                                
Chunk 21 of 25 (84%): state âœ“
#&gt; 
                                                                                
Chunk 22 of 25 (88%): state âœ“
#&gt; 
                                                                                
Chunk 23 of 25 (92%): state âœ“
#&gt; 
                                                                                
Chunk 24 of 25 (96%): state âœ“
#&gt; 
                                                                                
Chunk 25 of 25 (100%): state âœ“
#&gt; 
                                                                                
plot(D1, col = heat.colors(50))</code></pre>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e1-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e2.-5" class="level4">
<h4 class="anchored" data-anchor-id="e2.-5">E2.</h4>
<p>Modify the catalog to have a point density of 10 pts/m2 using the <code>decimate_points()</code> function. If you get an error make sure to read the documentation for <code>decimate_points()</code> and try: using <code>opt_output_file()</code> to <a href="https://r-lidar.github.io/lidRbook/engine.html#engine-dtm-ondisk">write files to a temporary directory</a>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>newctg <span class="ot">&lt;-</span> <span class="fu">decimate_points</span>(<span class="at">las =</span> ctg, <span class="at">algorithm =</span> <span class="fu">homogenize</span>(<span class="at">density =</span> <span class="dv">10</span>, <span class="at">res =</span> <span class="dv">5</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Error: This function requires that the LAScatalog provides an output file template.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_filter</span>(ctg) <span class="ot">&lt;-</span> <span class="st">"-drop_withheld"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">tempdir</span>(), <span class="st">"/{ORIGINALFILENAME}"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>newctg <span class="ot">&lt;-</span> <span class="fu">decimate_points</span>(<span class="at">las =</span> ctg, <span class="at">algorithm =</span> <span class="fu">homogenize</span>(<span class="at">density =</span> <span class="dv">10</span>, <span class="at">res =</span> <span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e2-sol-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<pre><code>#&gt; Chunk 1 of 25 (4%): state âœ“
#&gt; 
                                                                                
Chunk 2 of 25 (8%): state âœ“
#&gt; 
                                                                                
Chunk 3 of 25 (12%): state âœ“
#&gt; 
                                                                                
Chunk 4 of 25 (16%): state âœ“
#&gt; 
                                                                                
Chunk 5 of 25 (20%): state âœ“
#&gt; 
                                                                                
Chunk 6 of 25 (24%): state âœ“
#&gt; 
                                                                                
Chunk 7 of 25 (28%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 23s     
[====&gt;                                             ] 9% ETA: 24s     
                                                                                
Chunk 8 of 25 (32%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 24s     
[====&gt;                                             ] 9% ETA: 25s     
                                                                                
Chunk 9 of 25 (36%): state âœ“
#&gt; 
[====&gt;                                             ] 8% ETA: 25s     
[====&gt;                                             ] 8% ETA: 26s     
                                                                                
Chunk 10 of 25 (40%): state âœ“
#&gt; 
                                                                                
Chunk 11 of 25 (44%): state âœ“
#&gt; 
                                                                                
Chunk 12 of 25 (48%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 23s     
[====&gt;                                             ] 9% ETA: 25s     
                                                                                
Chunk 13 of 25 (52%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 22s     
[=====&gt;                                            ] 10% ETA: 23s     
                                                                                
Chunk 14 of 25 (56%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 23s     
[====&gt;                                             ] 9% ETA: 23s     
                                                                                
Chunk 15 of 25 (60%): state âœ“
#&gt; 
                                                                                
Chunk 16 of 25 (64%): state âœ“
#&gt; 
                                                                                
Chunk 17 of 25 (68%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 21s     
[====&gt;                                             ] 9% ETA: 22s     
                                                                                
Chunk 18 of 25 (72%): state âœ“
#&gt; 
[====&gt;                                             ] 9% ETA: 19s     
[====&gt;                                             ] 9% ETA: 23s     
[====&gt;                                             ] 9% ETA: 24s     
                                                                                
Chunk 19 of 25 (76%): state âœ“
#&gt; 
[=====&gt;                                            ] 10% ETA: 20s     
[=====&gt;                                            ] 10% ETA: 21s     
                                                                                
Chunk 20 of 25 (80%): state âœ“
#&gt; 
                                                                                
Chunk 21 of 25 (84%): state âœ“
#&gt; 
                                                                                
Chunk 22 of 25 (88%): state âœ“
#&gt; 
                                                                                
Chunk 23 of 25 (92%): state âœ“
#&gt; 
                                                                                
Chunk 24 of 25 (96%): state âœ“
#&gt; 
                                                                                
Chunk 25 of 25 (100%): state âœ“
#&gt; 
                                                                                </code></pre>
</div>
</section>
<section id="e3.-5" class="level4">
<h4 class="anchored" data-anchor-id="e3.-5">E3.</h4>
<p>Generate a raster of point density for this new decimated dataset.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(newctg) <span class="ot">&lt;-</span> <span class="st">""</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>D2 <span class="ot">&lt;-</span> <span class="fu">rasterize_density</span>(<span class="at">las =</span> newctg, <span class="at">res =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e3-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<pre><code>#&gt; Chunk 1 of 25 (4%): state âœ“
#&gt; 
                                                                                
Chunk 2 of 25 (8%): state âœ“
#&gt; 
                                                                                
Chunk 3 of 25 (12%): state âœ“
#&gt; 
                                                                                
Chunk 4 of 25 (16%): state âœ“
#&gt; 
                                                                                
Chunk 5 of 25 (20%): state âœ“
#&gt; 
                                                                                
Chunk 6 of 25 (24%): state âœ“
#&gt; 
                                                                                
Chunk 7 of 25 (28%): state âœ“
#&gt; 
                                                                                
Chunk 8 of 25 (32%): state âœ“
#&gt; 
                                                                                
Chunk 9 of 25 (36%): state âœ“
#&gt; 
                                                                                
Chunk 10 of 25 (40%): state âœ“
#&gt; 
                                                                                
Chunk 11 of 25 (44%): state âœ“
#&gt; 
                                                                                
Chunk 12 of 25 (48%): state âœ“
#&gt; 
                                                                                
Chunk 13 of 25 (52%): state âœ“
#&gt; 
                                                                                
Chunk 14 of 25 (56%): state âœ“
#&gt; 
                                                                                
Chunk 15 of 25 (60%): state âœ“
#&gt; 
                                                                                
Chunk 16 of 25 (64%): state âœ“
#&gt; 
                                                                                
Chunk 17 of 25 (68%): state âœ“
#&gt; 
                                                                                
Chunk 18 of 25 (72%): state âœ“
#&gt; 
                                                                                
Chunk 19 of 25 (76%): state âœ“
#&gt; 
                                                                                
Chunk 20 of 25 (80%): state âœ“
#&gt; 
                                                                                
Chunk 21 of 25 (84%): state âœ“
#&gt; 
                                                                                
Chunk 22 of 25 (88%): state âœ“
#&gt; 
                                                                                
Chunk 23 of 25 (92%): state âœ“
#&gt; 
                                                                                
Chunk 24 of 25 (96%): state âœ“
#&gt; 
                                                                                
Chunk 25 of 25 (100%): state âœ“
#&gt; 
                                                                                
plot(D2, col = heat.colors(50))</code></pre>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e3-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="e4.-3" class="level4">
<h4 class="anchored" data-anchor-id="e4.-3">E4.</h4>
<p>Read the whole decimated catalog as a single las file. The catalog isnâ€™t very big - not recommended for larger data sets!</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>las <span class="ot">&lt;-</span> <span class="fu">readLAS</span>(newctg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(las)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="e5.-2" class="level4">
<h4 class="anchored" data-anchor-id="e5.-2">E5.</h4>
<p>Read documentation for the <code>catalog_retile()</code> function and merge the dataset into larger tiles. Use <code>ctg</code> metadata to align new chunks to the lower left corner of the old ones. Hint: Visualize the chunks and use <code>opt_chunk_*</code> options.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_chunk_size</span>(ctg) <span class="ot">&lt;-</span> <span class="dv">280</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_chunk_buffer</span>(ctg) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_chunk_alignment</span>(ctg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">min</span>(ctg<span class="sc">$</span>Min.X), <span class="fu">min</span>(ctg<span class="sc">$</span>Min.Y))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ctg, <span class="at">chunk =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e5-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg) <span class="ot">&lt;-</span> <span class="st">"{tempdir()}/PRJ_A_{XLEFT}_{YBOTTOM}"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>newctg <span class="ot">&lt;-</span> <span class="fu">catalog_retile</span>(<span class="at">ctg =</span> ctg)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Chunk 1 of 9 (11.1%): state âœ“</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">2</span> of <span class="dv">9</span> (<span class="fl">22.2</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">3</span> of <span class="dv">9</span> (<span class="fl">33.3</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">4</span> of <span class="dv">9</span> (<span class="fl">44.4</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">5</span> of <span class="dv">9</span> (<span class="fl">55.6</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">6</span> of <span class="dv">9</span> (<span class="fl">66.7</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">7</span> of <span class="dv">9</span> (<span class="fl">77.8</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">8</span> of <span class="dv">9</span> (<span class="fl">88.9</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>Chunk <span class="dv">9</span> of <span class="dv">9</span> (<span class="dv">100</span>%)<span class="sc">:</span> state âœ“</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>                                                                                </span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(newctg)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/ctg-e5-2.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="engine" class="level2">
<h2 class="anchored" data-anchor-id="engine">8-ENGINE</h2>
<section id="e1.-6" class="level4">
<h4 class="anchored" data-anchor-id="e1.-6">E1.</h4>
<p>The following is a simple (and a bit naive) function to remove high noise points. - Explain what this function does - Create a user-defined function to apply using <code>catalog_map()</code> - Hint: Dont forget about buffered pointsâ€¦ remember <code>lidR::filter_*</code> functions.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>filter_noise <span class="ot">&lt;-</span> <span class="cf">function</span>(las, sensitivity)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  p95 <span class="ot">&lt;-</span> <span class="fu">pixel_metrics</span>(las, <span class="sc">~</span><span class="fu">quantile</span>(Z, <span class="at">probs =</span> <span class="fl">0.95</span>), <span class="dv">10</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  las <span class="ot">&lt;-</span> <span class="fu">merge_spatial</span>(las, p95, <span class="st">"p95"</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  las <span class="ot">&lt;-</span> <span class="fu">filter_poi</span>(las, Z <span class="sc">&lt;</span> <span class="dv">1</span><span class="sc">+</span>p95<span class="sc">*</span>sensitivity, Z <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">0.5</span>)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  las<span class="sc">$</span>p95 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(las)</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>filter_noise_collection <span class="ot">=</span> <span class="cf">function</span>(las, sensitivity)</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  las <span class="ot">&lt;-</span> <span class="fu">filter_noise</span>(las, sensitivity)</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  las <span class="ot">&lt;-</span> <span class="fu">filter_poi</span>(las, buffer <span class="sc">==</span> <span class="dv">0</span>L)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(las)</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>ctg <span class="ot">=</span> <span class="fu">readLAScatalog</span>(<span class="st">"data/Farm_A/"</span>)</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_select</span>(ctg) <span class="ot">&lt;-</span> <span class="st">"*"</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_filter</span>(ctg) <span class="ot">&lt;-</span> <span class="st">"-drop_withheld"</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_output_files</span>(ctg) <span class="ot">&lt;-</span> <span class="st">"{tempdir()}/*"</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_chunk_buffer</span>(ctg) <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="fu">opt_chunk_size</span>(ctg) <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>output <span class="ot">&lt;-</span> <span class="fu">catalog_map</span>(ctg, filter_noise_collection, <span class="at">sensitivity =</span> <span class="fl">1.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="06_solutions_files/figure-html/eng-e1-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
<pre><code>#&gt; Chunk 1 of 25 (4%): state âœ“
#&gt; 
                                                                                
Chunk 2 of 25 (8%): state âœ“
#&gt; 
                                                                                
Chunk 3 of 25 (12%): state âœ“
#&gt; 
                                                                                
Chunk 4 of 25 (16%): state âœ“
#&gt; 
                                                                                
Chunk 5 of 25 (20%): state âœ“
#&gt; 
                                                                                
Chunk 6 of 25 (24%): state âœ“
#&gt; 
                                                                                
Chunk 7 of 25 (28%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 15s     
[======&gt;                                           ] 12% ETA: 16s     
[======&gt;                                           ] 12% ETA: 17s     
[======&gt;                                           ] 12% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
                                                                                
Chunk 8 of 25 (32%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 17s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 12% ETA: 17s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 18s     
[======&gt;                                           ] 13% ETA: 18s     
                                                                                
Chunk 9 of 25 (36%): state âœ“
#&gt; 
[=====&gt;                                            ] 11% ETA: 18s     
[=====&gt;                                            ] 11% ETA: 18s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 12% ETA: 19s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 12% ETA: 19s     
[======&gt;                                           ] 12% ETA: 18s     
[======&gt;                                           ] 13% ETA: 19s     
                                                                                
Chunk 10 of 25 (40%): state âœ“
#&gt; 
[=========&gt;                                        ] 18% ETA: 9s     
                                                                                
Chunk 11 of 25 (44%): state âœ“
#&gt; 
                                                                                
Chunk 12 of 25 (48%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 15s     
[======&gt;                                           ] 12% ETA: 17s     
[======&gt;                                           ] 12% ETA: 16s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 17s     
                                                                                
Chunk 13 of 25 (52%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 13s     
[======&gt;                                           ] 12% ETA: 13s     
[======&gt;                                           ] 13% ETA: 14s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 16s     
[=======&gt;                                          ] 14% ETA: 16s     
[=======&gt;                                          ] 14% ETA: 17s     
[=======&gt;                                          ] 14% ETA: 17s     
                                                                                
Chunk 14 of 25 (56%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 14s     
[======&gt;                                           ] 12% ETA: 16s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 17s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 17s     
[=======&gt;                                          ] 14% ETA: 17s     
[=======&gt;                                          ] 14% ETA: 17s     
                                                                                
Chunk 15 of 25 (60%): state âœ“
#&gt; 
                                                                                
Chunk 16 of 25 (64%): state âœ“
#&gt; 
                                                                                
Chunk 17 of 25 (68%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 14s     
[======&gt;                                           ] 12% ETA: 15s     
[======&gt;                                           ] 12% ETA: 15s     
[======&gt;                                           ] 13% ETA: 15s     
[======&gt;                                           ] 13% ETA: 15s     
[======&gt;                                           ] 13% ETA: 15s     
[======&gt;                                           ] 13% ETA: 15s     
[======&gt;                                           ] 13% ETA: 15s     
[=======&gt;                                          ] 14% ETA: 15s     
                                                                                
Chunk 18 of 25 (72%): state âœ“
#&gt; 
[======&gt;                                           ] 12% ETA: 14s     
[======&gt;                                           ] 12% ETA: 15s     
[======&gt;                                           ] 12% ETA: 16s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 16s     
[======&gt;                                           ] 13% ETA: 15s     
[======&gt;                                           ] 13% ETA: 15s     
[=======&gt;                                          ] 14% ETA: 15s     
[=======&gt;                                          ] 14% ETA: 16s     
                                                                                
Chunk 19 of 25 (76%): state âœ“
#&gt; 
[======&gt;                                           ] 13% ETA: 13s     
[======&gt;                                           ] 13% ETA: 14s     
[======&gt;                                           ] 13% ETA: 14s     
[======&gt;                                           ] 13% ETA: 14s     
[=======&gt;                                          ] 14% ETA: 14s     
[=======&gt;                                          ] 14% ETA: 14s     
[=======&gt;                                          ] 14% ETA: 14s     
[=======&gt;                                          ] 14% ETA: 14s     
[=======&gt;                                          ] 14% ETA: 14s     
                                                                                
Chunk 20 of 25 (80%): state âœ“
#&gt; 
                                                                                
Chunk 21 of 25 (84%): state âœ“
#&gt; 
                                                                                
Chunk 22 of 25 (88%): state âœ“
#&gt; 
                                                                                
Chunk 23 of 25 (92%): state âœ“
#&gt; 
                                                                                
Chunk 24 of 25 (96%): state âœ“
#&gt; 
                                                                                
Chunk 25 of 25 (100%): state âœ“
#&gt; 
                                                                                

las &lt;- readLAS(output)
#&gt; 
[==============================================&gt;   ] 93% ETA: 0s     
[==============================================&gt;   ] 93% ETA: 0s     
[==============================================&gt;   ] 93% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 94% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[===============================================&gt;  ] 95% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 96% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[================================================&gt; ] 97% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 98% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
[=================================================&gt;] 99% ETA: 0s     
                                                                                
plot(las)</code></pre>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/r-lidar\.github\.io\/lidRbook\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>